<nav class="sb-topnav navbar navbar-expand navbar-dark p-2 mb-2 bg-white"
    style="box-shadow: 0 1px 1px rgb(226, 226, 226);">

    <a class="navbar-brand" href="/" style="color: black;">homeOS</a>
    <button class="btn btn-link btn-sm order-1 order-lg-0" id="sidebarToggle" href="#" style="color:black;"><i
            class="fas fa-bars"></i></button>

    {% load static %}
    <img src="{% static 'info.svg' %}" alt="!" type="button" href="" data-toggle="modal" data-target="#exampleModal">

    <span class="display-3" style="font-size: 12px;padding-left: 2px;" type="button" data-toggle="modal"
        data-target="#exampleModal">Weather info</span>
    <!-- Navbar-->
    <ul class="navbar-nav ml-auto ml-md-12">
        {% load notifications_tags %}
        <script src="{% static 'notifications/notify.js' %}" type="text/javascript"></script>
        {% register_notify_callbacks refresh_period=2 callbacks='fill_notification_badge' %}
        <script>
            arr_msg_lol = []

            function my_special_notification_callback(data) {
                arr_msg = []
                for (var i = 0; i < data.unread_list.length; i++) {
                    msg = data.unread_list[i];
                    arr_msg.push(msg);
                    // console.log(msg)
                }
                arr_msg_lol = JSON.parse(JSON.stringify(arr_msg))
            }
        </script>
        <li class="nav-item dropdown">
            <a class="nav-link " id="userDropdown" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false" style="color:black;" onclick="get_notif()">
                <img src="{% static 'notif.svg' %}" alt="!" class="dropbtn">
                <span class="badge badge-pill badge-warning" style="float:right;margin-bottom:-10px;">
                    {% live_notify_badge %}
                </span>

            </a>

            {% register_notify_callbacks refresh_period=2 callbacks='my_special_notification_callback' %}
            <ul class="dropdown-menu dropdown-menu-right dropdown-content" id="notice-link">
                <a href="{% url 'camera:read_notif' %}" type="submit" name='clear_btn'>Clear Notification</a>

            </ul>
        </li>
    </ul>
    <ul class="navbar-nav ml-auto ml-md-2">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="userDropdown" href="#" role="button" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false" style="color:black;"><i
                    class="fas fa-user fa-fw"></i>&nbsp;&nbsp;{{ request.user.username }}&nbsp;</a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                <a class="dropdown-item" href="{% url 'user_logout' %}">Logout</a>
            </div>
        </li>
    </ul>
</nav>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header" style="border-bottom: 0 none;">
                <center>
                    <h5 class="modal-title" id="exampleModalLabel">Weather Info</h5>
                </center>
                <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button> -->
            </div>
            <div class="modal-body">
                <center>
                    <p id="date-now"></p>
                    <span class="display-3" id="date-now" style="color:rgb(0, 0, 0);font-size: 15px;"></span>
                    <h5 class="modal-title" id="city-name"></h5>
                    <span id="icon" style="width: 10px;"></span>
                    <div id="temp" style="color:black;font-size: 15px; letter-spacing: 1px;" class="display-3">
                    </div>
                    <span id="desc" class="small" style="color: rgba(0, 0, 0, 0.705);"></span>
                </center>
            </div>
            <div class="modal-footer" style="border-top: 0 none;">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    function get_notif() {
        for (let i = 0; i < arr_msg_lol.length; i++) {
            // console.log(arr_msg_lol[i].verb);
            if (!document.getElementById(`${arr_msg_lol[i].id}`)) {
                var string = `<li id='${arr_msg_lol[i].id}'>${arr_msg_lol[i].verb}</li>`
                $('#notice-link').append(string)
            }
        }
    }
</script>